#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <semaphore.h>

#define BUFFER_SIZE 5

int buffer[BUFFER_SIZE];
int in = 0, out = 0;

sem_t empty;     // Counts empty slots
sem_t full;      // Counts filled slots
pthread_mutex_t mutex;

// Producer Function
void* producer(void* arg) {
    int item;

    for (int i = 0; i < 10; i++) {
        item = rand() % 100;

        sem_wait(&empty);               // Wait if buffer is full
        pthread_mutex_lock(&mutex);     // Lock critical section

        buffer[in] = item;
        printf("Producer produced: %d\n", item);
        in = (in + 1) % BUFFER_SIZE;

        pthread_mutex_unlock(&mutex);   // Unlock critical section
        sem_post(&full);                // Increase number of filled slots
    }

    return NULL;
}

// Consumer Function
void* consumer(void* arg) {
    int item;

    for (int i = 0; i < 10; i++) {

        sem_wait(&full);                // Wait if buffer is empty
        pthread_mutex_lock(&mutex);     // Lock critical section

        item = buffer[out];
        printf("Consumer consumed: %d\n", item);
        out = (out + 1) % BUFFER_SIZE;

        pthread_mutex_unlock(&mutex);   // Unlock critical section
        sem_post(&empty);               // Increase empty slots
    }

    return NULL;
}

int main() {
    pthread_t prodThread, consThread;

    sem_init(&empty, 0, BUFFER_SIZE);   // buffer initially empty
    sem_init(&full, 0, 0);              // no items initially
    pthread_mutex_init(&mutex, NULL);

    pthread_create(&prodThread, NULL, producer, NULL);
    pthread_create(&consThread, NULL, consumer, NULL);

    pthread_join(prodThread, NULL);
    pthread_join(consThread, NULL);

    sem_destroy(&empty);
    sem_destroy(&full);
    pthread_mutex_destroy(&mutex);

    return 0;
}

Output:
Producer produced: 83
Producer produced: 86
Producer produced: 77
Producer produced: 15
Producer produced: 93
Consumer consumed: 83
Consumer consumed: 86
Consumer consumed: 77
Consumer consumed: 15
Consumer consumed: 93
Producer produced: 35
Producer produced: 86
Producer produced: 92
Producer produced: 49
Producer produced: 21
Consumer consumed: 35
Consumer consumed: 86
Consumer consumed: 92
Consumer consumed: 49
Consumer consumed: 21


=== Code Execution Successful ===
